<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Checkers Login</title>
  <style>
    
    .section {
      display: none;
    }

    .active {
        display: block;
    }

    iframe {
      width: 100%;
      height: 100vh;
      border: none;
    }
  </style>
<!--import module from validation.js-->
<script type="module">
  //connection to backend server on port 9180
  const socket= new WebSocket("ws://"+window.location.hostname+":9180");
  
  import {inputValidator} from './validation.js';

  //Signup- TJV
  function validateSignup() 
    //Parse Each Element
    {
      inputValidator.clearErrors();
      const username = document.getElementById("signupUsername").value;
      const email = document.getElementById("signupEmail").value;
      const password = document.getElementById("signupPassword").value;
      const confirmPassword = document.getElementById("signupConfirmPassword").value;
    
      let valid = true;

      const usernameError= inputValidator.validateUsername(username);
      const passwordError= inputValidator.validatePassword(password);
      const emailError= inputValidator.validateEmail(email);

      if (usernameError){
        inputValidator.displayError("signupUsernameError", usernameError);
        valid=false;
      }

      if(passwordError){
        inputValidator.displayError("signupPasswordError", passwordError);
        valid=false;
      }

      if(emailError){
        inputValidator.displayError("signupEmailError", emailError);
        valid=false;
      }

      if (password!= confirmPassword){
        inputValidator.displayError("signupConfirmPasswordError", "Passwords do not match.");
        valid=false;
      }
      
      //Sending info to page manager/database
      if (valid) {
        const signupMessage= {
          eventType: "signup", //Changed from login to signup-AK
          username,
          password,
          email,
        };
        socket.send(JSON.stringify(signupMessage));
          }
    };

  //Login-IM
  function validateLogin()
    {
        inputValidator.clearErrors();
        const username = document.getElementById("loginUsername").value;
        const password = document.getElementById("loginPassword").value;

        let valid = true;

        const usernameError = inputValidator.validateUsername(username);

        if (usernameError)
        {
          inputValidator.displayError("loginUsernameError", usernameError);
          valid = false;
        }

        if (!password)
        {
          inputValidator.displayError("loginPasswordError", "Password cannot be empty.");
          valid = false;
        }

        if (valid) {
        const signupMessage= {
          eventType: "login",
          username,
          password,
        };
        socket.send(JSON.stringify(signupMessage));
          }
      }
      window.addEventListener("DOMContentLoaded", () => {
  
  let login = document.getElementById("loginButton");
  let signup = document.getElementById("signupButton");

  //handle login
  if (login) {
    login.addEventListener("click", validateLogin);
  }

  //handle signuip
  
  if (signup) {
    signup.addEventListener("click", validateSignup);
  }

  // Show login page by default
  document.getElementById("login-section").style.display = "block";
});


</script>
</head>

<body>

  <!-- all the .css, .js, and .html were merged into one file for the purpose of these iframes, it is much easier to reference and debug these this way.-->
  <!-- Login Section -->
  <div id="login-section" class="section">
    <iframe id="loginFrame" src="login/login.html"></iframe>
  </div>

  <!-- JoinGame Section -->
  <div id="joingame-section" class="section">
   <iframe id="joingameFrame" src="Joingame/joingame.html"></iframe>
    <!--    <script src="script.js"></script> -->
    <!--<iframe id="joinFrame" src="JoinGame/index.html"></iframe> -->
  </div>

  <!-- GameDisplay Section -->
  <div id="gamedisplay-section" class="section">
    <iframe id="gamedisplayFrame" src="Gamedisplay/game_display.html"></iframe>
  </div>

  <!-- Leaderboard Section -->
  <div id="leaderboard-section" class="section">
    <iframe id="leaderboardFrame" src="Leaderboard/leaderboard.html"></iframe>
  </div>
      <!-- <div class="hide">
          <button class="show" onclick="showContent()">Open</button>
            <div id="leaderboard">
          </div>
      </div> -->

  <script src="js/PageManager.js"></script>
  <!--<script src="JoinGame/script.js"></script> --> <!-- what a name, script.js -->
  <!--<script src="Leaderboard/summary.js"</script>   need to change this-->
  <!--<script src="login/validation.js"</script> -->

  
</body>

</html>