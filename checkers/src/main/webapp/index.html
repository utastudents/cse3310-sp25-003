<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkers</title>
  <link rel="stylesheet" href="login/loginstyle.css">
  <link rel="stylesheet" href="Gamedisplay/gamedisplay.css">
  <link rel="stylesheet" href="Leaderboard/myStyle.css">
  <link rel="stylesheet" href="JoinGame/style.css">

</head>

<body>
  <div id="login-section">
    <h1 style="text-align: center">CHECKERS</h1>

    <div id="login-section" class="form-section">
      <h2>Login</h2>
      <label>Username:</label>
      <input
        required
        type="text"
        name="loginUsername"
        id="loginUsername"
        placeholder="Username"
      />
      <div class="error" id="loginUsernameError"></div>

      <label>Password:</label>
      <input
        required
        type="password"
        name="loginPassword"
        id="loginPassword"
        placeholder="Password"
      />
      <div class="error" id="loginPasswordError"></div>

      <button id="loginButton">LOGIN</button>
    </div>


    <div id="signup-section" class="form-section">
      <h2>Sign Up</h2>
      <label>Username:</label>
      <input type="text" id="signupUsername" placeholder="Username" />
      <div class="error" id="signupUsernameError"></div>

      <label>Email:</label>
      <input type="email" id="signupEmail" placeholder="Email" />
      <div class="error" id="signupEmailError"></div>

      <label>Password:</label>
      <input type="password" id="signupPassword" placeholder="Password" />
      <div class="error" id="signupPasswordError"></div>

      <label>Confirm Password:</label>
      <input
        type="password"
        id="signupConfirmPassword"
        placeholder="Confirm Password"
      />
      <div class="error" id="signupConfirmPasswordError"></div>

      <button id="signupButton">Create Account</button>
    </div>

 
  </div>
  <div id="joingame-section" class="section">
    <section id="banner">
      <div id="top-banner">
        <div id="section3">
          <!-- Code: Section 3 -->
          section 3
        </div>
        <div id="button-wrapper1">
          <button id="addPlayer" onclick="addPlayerToLobby">
            <!-- Code: Button (add player) -->
            Add Player
          </button>
        </div>
      </div>

      <div id="lower-banner">
        <div id="title">
          <!-- Code:Title for the game -->
          CHECKERS
        </div>
      </div>
    </section>

    <section id="seperator">
      <div id="line"></div>
    </section>

    <section id="main">
      <div id="container">
        <div id="main-left">
          <!--Code: to put in Buttons for selecting Players -->
          <div id="players-row">
            <div id="left-column">
              <button class="selection-button" id="player1" data-value="1">
                Player 1
              </button>
              <button class="selection-button" id="bot1" data-value="0">
                BOT1
              </button>
            </div>
            <div id="middle-column">
              <div id="button-wrapper2">
                <div id="selectPlayer">
                  <p id="sP">Select Players</p>
                </div>
              </div>
            </div>
            <div id="right-column">
              <button class="selection-button" id="player2" data-value="1">
                Player 2
              </button>
              <button class="selection-button" id="bot2" data-value="0">
                BOT2
              </button>
            </div>
          </div>
        </div>
        <div id="main-right-wrapper">
          <div id="main-right">
            <!--Code: to put in the list of Active Players in the game -->
            <p id="mr">Active Players</p>
          </div>
        </div>
      </div>
    </section>

    <section id="seperator">
      <div id="line"></div>
    </section>

    <section id="lobby">
      <div id="container">
        <div id="lobby-main">
          <div id="lobby-top">
            <div id="lobby-Title-Card">
              <!-- Code: "Lobby" Name(only the name) -->
              <p id="lobbywrite">LOBBIES</p>
            </div>
            <div id="refresh">
              <!-- will refresh the lobby -->
              <button id="refresh-button">Refresh</button>
            </div>
          </div>
          <div id="lobby-bottom">
            <!-- It should be scrollable-->
            <!-- This is where all 10 lobbies go -->
            <ul>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 1
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class = "join-game" onclick="joinLobby(1)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class ="wait-game" onclick="waitLobby(1)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 2
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(2)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(2)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 3
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(3)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(3)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 4
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(4)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(4)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 5
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(5)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(5)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 6
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(6)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(6)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 7
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(7)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(7)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 8
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed  -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(8)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies  -->
                </button>

                <button class="wait-game" onclick="waitLobby(8)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered -->
                  Lobby Name 9
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(9)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(9)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
              <li id="lobby-item">
                <div id="lobby-name">
                  <!-- This is where lobby name is entered  -->
                  Lobby Name 10
                </div>

                <div id="capacity">
                  <!-- This is where the current number of player in the lobby is displayed -->
                  0/2
                </div>

                <button class="join-game" onclick="joinLobby(10)">
                  <!-- join-game is a single class and button is another single class. Button can inherit all the attributes from the button class defined in Add-player Button. So no need to code it once again you can tweak it/overwrite as we dclass with java function-->
                  Join Lobby
                  <!-- This is where Join Game Button lies -->
                </button>

                <button class="wait-game" onclick="waitLobby(10)">
                  wait
                  <!-- This is where Wait button lies -->
                </button>
              </li>
            </ul>
          </div>
        </div>

        <div id="back-button" onclick="handleBackButton()">
          <button id="back">Back</button>
        </div>
      </div>
    </section>

    <!--    <script src="script.js"></script> -->
    <!--<iframe id="joinFrame" src="JoinGame/index.html"></iframe> -->
  </div>
  <div id="gamedisplay-section">
    <div class="game-wrapper">
      <div class="left-column">
        <h1 class="playerdata"><span id = "player1username">Player1 </span><span id="player1elo">0</span></h1>
        <div class="board" id="board"></div>
        <h1 class="playerdata"><span id ="player2username">Player2 </span><span id="player2elo">0</span></h1>
        <!-- commented out temporarily, box currently displays over the board.
        <div class="displaybox">
          <h1 class="displaytext"><span id="endgamestate">Win/Loss/Draw</span></h1>
        </div>
        -->
     </div>
    
      <div class="right-column">
        <button id="soundToggle" class="sound-control" title="Toggle Sound">🔊</button>
    
        <button id="resignBtn" class="resign-button">Resign</button>
        <button id="drawBtn" class="draw-button">Propose Draw</button>
        <button id="toggleTheme" class="theme-toggle-button">Toggle Mode</button>
        <div id="drawNotification" style="display:none; margin-top: 10px; font-weight: bold; color: #0077cc;"></div>
        <div id="drawTimer" style="display:none; font-size: 1.2em; margin-top: 5px;"></div>
        <button id="acceptDrawBtn" class="draw-button" style="display: none;">Accept Draw</button>
      </div>
  </div>
  </div>
  <!-- <div class="hide">
        <button class="show" onclick="showContent()">Open</button>
          <div id="leaderboard">
        </div>
    </div> -->

  <script src="js/PageManager.js"></script>
  <script src="JoinGame/script.js"></script>
  <!-- what a name, script.js -->
  <!--<script src="Leaderboard/summary.js"</script>   need to change this-->
  <script src="login/validation.js"> </script>
</body>

</html>

<script type="module">
  var clientId = 0;

  console.log("Creating socket");
  const socket = new WebSocket(
    "ws://" + window.location.hostname + ":" + (parseInt(location.port) + 100)
  );

  window.socket = socket;

  import { inputValidator } from "./validation.js";
  
  socket.onopen = function (evt) {
    console.log("open");
  }

  socket.onclose = function (evt) {
    console.log("close");
  }

  socket.onmessage = function (evt){
    const msg = evt.data;
    console.log("Message received: "+msg);

    let data = JSON.parse(msg);

    if ('message' in data && data.message=="User logged in successfully" && data.success==true){
      if (data.success) {
            alert("Welcome Back! Let's Play Again!!");
            console.log("Exiting Login/SignUp page and showing JoinLobby page");
            document.getElementById("login-section").style.display = "none";
            document.getElementById("joingame-section").style.display = "block";
            document.getElementById("gamedisplay-section").style.display = "none";
            const script = document.createElement('script');
            script.src = 'joinGame/script.js';
            script.onload = () => {
              console.log("joinGame/script.js loaded, now calling requestPlayersUserName()");
                requestPlayersUserName();
            };
            document.body.appendChild(script);
      } else {
        //If not, ask them to create account
        alert("Yay this is your first time! Please Signup :)");
      }
    }

    else if('message' in data && data.message=="Players list retrieved successfully" ){
      console.log("Retriving Username/s");
      handleUsernames(data.playersList);
      console.log("Usernames: "+data.playersList);
    }

    // else if('messsage' in data && data.message=="GameDisplay is not handled by PM")
  }

  document.getElementById("login-section").style.display = "block";
  document.getElementById("joingame-section").style.display = "none";
  document.getElementById("gamedisplay-section").style.display = "none";


  //Signup- TJV
  function validateSignup() {
    //Parse Each Element
    inputValidator.clearErrors();
    const username = document.getElementById("signupUsername").value;
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;
    const confirmPassword = document.getElementById(
      "signupConfirmPassword"
    ).value;

    let valid = true;

    const usernameError = inputValidator.validateUsername(username);
    const passwordError = inputValidator.validatePassword(password);
    const emailError = inputValidator.validateEmail(email);

    if (usernameError) {
      inputValidator.displayError("signupUsernameError", usernameError);
      valid = false;
    }

    if (passwordError) {
      inputValidator.displayError("signupPasswordError", passwordError);
      valid = false;
    }

    if (emailError) {
      inputValidator.displayError("signupEmailError", emailError);
      valid = false;
    }

    if (password != confirmPassword) {
      inputValidator.displayError(
        "signupConfirmPasswordError",
        "Passwords do not match."
      );
      valid = false;
    }

    //Sending info to page manager/database
    if (valid) {
      let msg = JSON.stringify({ username, password, email });
      const signupMessage = {
        eventType: "signup", //Changed from login to signup-AK
        msg,
      };
      console.log("sending "+ JSON.stringify(signupMessage));
      socket.send(JSON.stringify(signupMessage));
    }
  }

  //Login-IM
  function validateLogin() {
    inputValidator.clearErrors();
    const username = document.getElementById("loginUsername").value;
    const password = document.getElementById("loginPassword").value;

    let valid = true;

    const usernameError = inputValidator.validateUsername(username);

    if (usernameError) {
      inputValidator.displayError("loginUsernameError", usernameError);
      valid = false;
    }

    if (!password) {
      inputValidator.displayError(
        "loginPasswordError",
        "Password cannot be empty."
      );
      valid = false;
    }

    if (valid) {
      let msg = JSON.stringify({ username, password });
      const signupMessage = {
        eventType: "login",
        msg,
      };
      console.log("sending "+JSON.stringify(signupMessage));
      socket.send(JSON.stringify(signupMessage));
    }
  }


  window.addEventListener("DOMContentLoaded", () => {
      let login = document.getElementById("loginButton");
      let signup = document.getElementById("signupButton");


      //handle login
      if (login) {
        login.addEventListener("click", validateLogin);
      }

      //handle signuip

      if (signup) {
        signup.addEventListener("click", validateSignup);
      }

      // Show login page by default
      document.getElementById("login-section").style.display = "block";
      document.getElementById("signup-section").style.display = "block";
    });

</script>

<script type="module" src="js/PageManager.js"></script>
<!-- <script src="JoinGame/script.js"></script> -->
<script type="module" src="login/validation.js"> </script>