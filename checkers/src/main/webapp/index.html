<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <style>
    
    .section {
      display: none;
      width: 100%;
      height: 100vh;
    }

    .active {
        display: block;
    }

    iframe {
      width: 100%;
      height: 100vh;
      border: none;
    }
  </style>
</head>

<body>

  <!-- all the .css, .js, and .html were merged into one file for the purpose of these iframes, it is much easier to reference and debug these this way.-->
  <!-- Login Section -->
  <div id="login-section" class="section">
    <iframe id="loginFrame" src="login/login.html"></iframe>
  </div>

  <!-- JoinGame Section -->
  <div id="joingame-section" class="section">
   <iframe id="joingameFrame" src="Joingame/joingame.html"></iframe>
    <!--    <script src="script.js"></script> -->
    <!--<iframe id="joinFrame" src="JoinGame/index.html"></iframe> -->
  </div>

  <!-- GameDisplay Section -->
  <div id="gamedisplay-section" class="section">
    <iframe id="gamedisplayFrame" src="Gamedisplay/game_display.html"></iframe>
  </div>

  <!-- Leaderboard Section -->
  <div id="leaderboard-section" class="section">
    <iframe id="leaderboardFrame" src="Leaderboard/leaderboard.html"></iframe>
  </div>
      <!-- <div class="hide">
          <button class="show" onclick="showContent()">Open</button>
            <div id="leaderboard">
          </div>
      </div> -->

  <script src="js/PageManager.js"></script>
  <!-- <script src="JoinGame/script.js"></script> what a name, script.js -->
  <!--<script src="Leaderboard/summary.js"</script>   need to change this-->
  <!--<script src="login/validation.js"</script> -->

  <script>
    let pageManager = new PageManager("ws://" + window.location.hostname + ":" + (parseInt(location.port) + 100));
      // for now, lets extract the websocket connection so it can be used by non-object oriented
      // code
    let connection = pageManager.connection(); 

    //for methods in iframes that *need* the websocket delivered like this
    window.sharedWebSocket = connection; 
    window.pagewManager = PageManager; 

    console.log("the websocket connection is " + connection);
    // Show login page by default
    document.getElementById("login-section").style.display = "block";

    function handleLogin() {
      pageManager.validateLogin();
    }

    window.switchSection = function(sectionID){
      //hides all sections
      document.querySelectorAll('.section').forEach(section =>{ section.style.display = "none"});
      //shows the section with the matching id
      document.getEelmentById(sectionID = "-section").style.display = "block";
    }

    connection.addEventListener('message', function(event) {
      const message = JSON.parse(event.data);
      console.log("Message recieved from server:", message);

      //for all ui navigation cases put switchSection() cases here in this event listener
      if (message.message === "Login successful" && message.success === true) {
        console.log("Login success");
        switchToSection("joingame");
      }

    })

    //add in functions for recieving data from the current iframe
    function handleLogin() {
      pageManager.validateLogin();
    }

  </script>
</body>

</html>
